<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">	<!-- 규칙 -->

<mapper namespace="group.riding.GroupMapper">

	<!-- 그룹 생성 -->
	<insert id="create_gr">
		insert into gr_group(gr_name, gr_leader,
		gr_content,gr_icon)
		values (#{gr_name}, #{gr_leader},
		#{gr_content},#{gr_icon})
	</insert>

	<!-- 그룹 관계 -->
	<insert id="gr_gr">
		insert into gr_gr(gr_name, uid, introduce)
		values
		(#{gr_name}, #{uid}, #{introduce})
	</insert>

	<!-- 그룹 아이콘 -->
	<insert id="icon">	<!-- 프로필 -->
		insert into gr_icon(fullName, gr_name)
		values(#{files}, #{gr_name})
	</insert>

	<!-- 그룹 정보 -->
	<select id="gr_info" resultType="GroupBean">
		select * from gr_group
		where
		gr_name= #{gr_name};
	</select>

	<!-- 그룹 아이콘 -->
	<select id="gr_icon" resultType="string">
		select a.fullName, b.gr_name
		from gr_icon a, gr_group b
		where a.gr_name=#{gr_name}
	</select>

	<!-- 그룹 리스트 (내그룹) -->
	<select id="gr_list" resultType="GroupBean">
		select
		b.gr_name,b.gr_content,b.gr_icon,b.gr_date,b.gr_leader,b.gr_id
		from
		gr_gr a, gr_group b
		where a.gr_name=b.gr_name
		and a.uid=#{uid};
	</select>

	<!-- 그룹 리스트 (내가 가입한 그룹 제외) -->
	<select id="gr_list_other" resultType="GroupBean">
		select
	 distinct b.gr_name,b.gr_content,b.gr_icon,b.gr_date,b.gr_leader,b.gr_id
		from
		gr_gr a , gr_group b
		where a.gr_name=b.gr_name
		and a.uid != #{uid}
		and b.gr_leader!=#{uid};

	</select>


	<!-- 그룹 아이콘 -->
	<select id="gr_iconl" resultType="string">
		select fullName, gr_name
		from
		gr_icon=gr_group
	</select>

	<!-- 그룹인원 -->
	<select id="gr_people" resultType="int">
		select count(*)
		from gr_gr
		where gr_name=#{gr_name}
	</select>

	<!-- 그룹 가입 -->
	<insert id="gr_join">
		insert into gr_gr(gr_name, uid, introduce)
		values
		(#{gr_name}, #{uid}, #{introduce})
	</insert>

	<select id="gr_check" resultType="String">
		select uid
		from gr_gr
		where
		uid=#{uid} and gr_name=#{gr_name}
	</select>

	<!-- 그룹 랭킹 -->
	<select id="gr_number" resultType="GroupRank">

		<!-- SET @row_number = 0; -->

		SELECT (@row_number:=@row_number + 1) AS num, gr_name, gr_number FROM
		gr_group order by gr_number desc LIMIT 5;
	</select>


	<select id="gr_catch" resultType="GroupRank">

		<!-- SET @row_number = 0; -->

		SELECT (@row_number:=@row_number + 1) AS num, gr_name, gr_catch FROM
		gr_group order by gr_catch desc LIMIT 5;
	</select>


	<select id="gr_avspeed" resultType="GroupRank">

		<!-- SET @row_number = 0; -->

		SELECT (@row_number:=@row_number + 1) AS num, gr_name, gr_avspeed FROM
		gr_group order by gr_avspeed desc LIMIT 5;
	</select>

	<!-- 그룹게시판 맴퍼 -->


	<insert id="info_cr"> insert into
		bbs_writing(bbs_id,writing_title,
		writing_content, member_id, group_id)
		values ('group',#{writing_title},
		#{writing_content},#{member_id},#{group_id})
	</insert>

	<select id="info_bo" resultType="GroupInfoBoard">
		select
		group_id,member_id,bbs_id,writing_title,writing_content,view_Number,writing_id,regist_date
		from bbs_writing where bbs_id='group' and group_id=#{groupid}
	</select>

	<select id="info_li" resultType="GroupInfoList">
		select att.fullname, att.uid, gr.riding_no, gf.alldistance, gf.avgspeed
		from gr_gr gr, gr_attach att, gr_ridinginfo gf
		where gr.uid=att.uid and att.uid=gf.uid
		and gr.uid=#{uid}
		order by gf.riding_id desc;
	</select>
	<!-- 그룹명 중복체크 -->
	<select id="n_check" resultType="int">
		select count(*)
		from gr_group
		where gr_name = #{gr_name};
	</select>
	
	<!-- 그룹장만 공지생성 -->
	<select id="leaderNotice" resultType="String">
		select introduce
		from gr_gr
		where uid=#{uid} and gr_name=#{gr_name}
	</select>

	<select id="info_re" resultType="GroupInfoBoard">
		select
		group_id,member_id,bbs_id,writing_title,writing_content,view_Number,writing_id,regist_date
		from bbs_writing
		where writing_id=#{writing_id}
	</select>
	
	<delete id="info_del" >
		delete from bbs_writing where writing_id=#{writing_id}
	</delete>


</mapper>