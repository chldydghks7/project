<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">	<!-- 규칙 -->
  
<mapper namespace="group.riding.NoticeMapper">
	
	<!-- 공지 생성 -->
	<insert id="createNotice">	
		insert into gr_notice(gr_name, notice_title, start_point, end_point, ridingDate, ridingTime, material)
  		values (#{gr_name}, #{notice_title}, #{start_point}, #{end_point}, #{ridingDate}, #{ridingTime}, #{material})
	</insert>
	
	<select id="listNotice" resultType="NoticeBean">
		select * from gr_notice
		where gr_name = #{gr_name}
	</select>
	
	<select id="infoNotice" resultType="NoticeBean">
		select * from gr_notice
 		where noticeId= #{noticeId}
	</select>
	
	<select id="userNotice" resultType="NoticeBean">	<!--  개인 캘린더 -->
		select * from gr_notice, gr_gr
		where gr_notice.gr_name = gr_gr.gr_name 
		and gr_gr.uid=#{uid};
		<!-- select *
		from gr_notice n 
		left join gr_usernotijoin u
		on n.noticeId = u.noticeId
		left join gr_gr g
		on n.gr_name = g.gr_name
		where g.uid=#{uid}
		and u.uid=#{uid}; -->
	</select>
	
	<!-- 공지 참여 -->
	<insert id="joinNotice">
		insert into gr_usernotijoin(uid, noticeId, joing)
		values (#{uid}, #{noticeId}, #{joing})
	</insert>
	
	<select id="joinCheck" resultType="String">
		select joing 
		from gr_usernotijoin
		where noticeId=#{noticeId} and uid = #{uid}
	</select>
	
	<select id="noticeCheck" resultType="NoticeBean">	<!-- 창조주님 !! 그룹명 + 참여여부 -->
		select *
		from gr_notice, gr_usernotijoin
		where gr_notice.noticeId = gr_usernotijoin.noticeId
		and gr_usernotijoin.uid=#{uid}
	</select>
	
	<update id="updateCheck">
		update gr_usernotijoin set joing=#{joing}
		where noticeId=#{noticeId} and uid = #{uid}
	</update>
	
	<!-- 개인 라이딩 캘린더 -->
	<select id="ridingDate" resultType="RidingInfoBean">
		select * from gr_ridinginfo 
		where uid=#{uid}
	</select>
	
	<select id="ridingInfo" resultType="RidingInfoBean">
		select * from gr_ridinginfo a,gr_kml b
		where a.kml_id=b.kml_id
		and riding_id=#{riding_id}
		
	</select>
	
	<select id="joinInfo" resultType="NoticeBean">
		select b.uid,b.joing from
		gr_gr a, gr_usernotijoin b
		where a.uid=b.uid and noticeId=#{noticeId} and gr_name =#{gr_name};
	</select>
	
	
</mapper>